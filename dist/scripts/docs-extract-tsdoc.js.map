{
  "version": 3,
  "sources": ["scripts/docs-extract-tsdoc.ts", "common/util/index.ts", "common/types/index.ts", "common/const/Urls.ts", "common/const/Ids.ts", "opensource/sdk-js/packages/react/common/lib/messageNode.ts"],
  "sourcesContent": ["#!/usr/bin/env -S node --enable-source-maps\r\n\r\n/**\r\n * This script compiles our opensource code, extracts the exported symbols from\r\n * the TypeScript compiler output, and generates a file in the same format as\r\n * TJV outputs, so that we can use them in our docs.\r\n *\r\n * In general, you want to run docs-codegen.sh, which builds and runs everything\r\n * necessary for the docs (both this and TJV), rather than running this script\r\n * directly.\r\n */\r\n\r\nimport 'dotenv/config.js';\r\nimport * as path from 'path';\r\n\r\nimport * as prettier from 'prettier';\r\nimport ts from 'typescript';\r\n\r\nimport {\r\n  DocNodeKind,\r\n  StandardTags,\r\n  TSDocConfiguration,\r\n  TSDocParser,\r\n  TSDocTagDefinition,\r\n  TSDocTagSyntaxKind,\r\n} from '@microsoft/tsdoc';\r\nimport type {\r\n  DocSection,\r\n  DocPlainText,\r\n  DocEscapedText,\r\n  DocCodeSpan,\r\n  DocFencedCode,\r\n  DocNode,\r\n  DocNodeContainer,\r\n  DocParagraph,\r\n  DocBlock,\r\n  DocErrorText,\r\n  DocComment,\r\n} from '@microsoft/tsdoc';\r\nimport type {\r\n  Property,\r\n  PropertiesList,\r\n  AnyOf,\r\n  Interface,\r\n  Method,\r\n  SingleMethod,\r\n} from 'docs/server/ui/propertiesList/types.ts';\r\n\r\nimport { isDefined } from 'common/util/index.ts';\r\n\r\nconst TSDOC_CONFIG = new TSDocConfiguration();\r\nTSDOC_CONFIG.addTagDefinitions([\r\n  new TSDocTagDefinition({\r\n    tagName: '@minLength',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n  new TSDocTagDefinition({\r\n    tagName: '@maxLength',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n  new TSDocTagDefinition({\r\n    tagName: '@format',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n  new TSDocTagDefinition({\r\n    tagName: '@minimum',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n  new TSDocTagDefinition({\r\n    tagName: '@maximum',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n  new TSDocTagDefinition({\r\n    tagName: '@minItems',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n  new TSDocTagDefinition({\r\n    tagName: '@maxItems',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n  new TSDocTagDefinition({\r\n    tagName: '@additionalProperties',\r\n    syntaxKind: TSDocTagSyntaxKind.BlockTag,\r\n  }),\r\n]);\r\n\r\ntype Writeable<T> = { -readonly [P in keyof T]: Writeable<T[P]> };\r\n\r\ninterface Namespace {\r\n  [key: string]: Namespace | Interface | Method;\r\n}\r\n\r\nfunction containerToMarkdown(\r\n  container: DocNodeContainer,\r\n  customBlocks?: readonly DocBlock[],\r\n) {\r\n  let content = nodesToMarkdown(container.nodes);\r\n  if (customBlocks) {\r\n    for (const block of customBlocks) {\r\n      if (block.blockTag.tagNameWithUpperCase === '@MAXITEMS') {\r\n        content += `\\n\\nThis field has a maximum length of ${containerToMarkdown(\r\n          block.content,\r\n        )}.`;\r\n      }\r\n    }\r\n  }\r\n  return content;\r\n}\r\n\r\nfunction nodesToMarkdown(nodes: readonly DocNode[]) {\r\n  return nodesToMarkdownInternal(nodes).trim();\r\n}\r\n\r\nfunction nodesToMarkdownInternal(nodes: readonly DocNode[]) {\r\n  let result = '';\r\n  for (const node of nodes) {\r\n    switch (node.kind) {\r\n      case DocNodeKind.PlainText:\r\n        result += (node as DocPlainText).text.replaceAll(\r\n          '(https://docs.cord.com/',\r\n          '(/',\r\n        );\r\n        break;\r\n      case DocNodeKind.EscapedText:\r\n        result += (node as DocEscapedText).decodedText;\r\n        break;\r\n      case DocNodeKind.CodeSpan:\r\n        result += '`' + (node as DocCodeSpan).code + '`';\r\n        break;\r\n      case DocNodeKind.FencedCode: {\r\n        const fencedCode = node as DocFencedCode;\r\n        result +=\r\n          '```' + fencedCode.language + '\\n' + fencedCode.code + '\\n```';\r\n        break;\r\n      }\r\n      case DocNodeKind.Section:\r\n        result += nodesToMarkdownInternal((node as DocSection).nodes);\r\n        break;\r\n      case DocNodeKind.SoftBreak:\r\n        result += ' ';\r\n        break;\r\n      case DocNodeKind.Paragraph:\r\n        result +=\r\n          nodesToMarkdownInternal((node as DocParagraph).nodes) + '\\n\\n';\r\n        break;\r\n      case DocNodeKind.ErrorText: {\r\n        const errorTextNode = node as DocErrorText;\r\n        throw new Error(\r\n          `The docs have a TSDoc formatting error: ${errorTextNode.errorMessage}\\n\\n${errorTextNode.textExcerpt}`,\r\n        );\r\n      }\r\n      case DocNodeKind.BlockTag:\r\n        // A tag like @format or @example, which we can just ignore, it's not\r\n        // part of the text\r\n        break;\r\n      default:\r\n        throw new Error(`Unknown doc node kind: ${node.kind}`);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction extractExamples(customBlocks: readonly DocBlock[]) {\r\n  const exampleBlocks = customBlocks.filter(\r\n    (b) =>\r\n      b.blockTag.tagNameWithUpperCase ===\r\n      StandardTags.example.tagNameWithUpperCase,\r\n  );\r\n  const result: Record<string, string> = {};\r\n  for (const exampleBlock of exampleBlocks) {\r\n    let nodes = exampleBlock.content.nodes;\r\n    let key = 'Example';\r\n    if (nodes[0].kind === DocNodeKind.Paragraph) {\r\n      key = containerToMarkdown(nodes[0] as DocParagraph);\r\n      nodes = nodes.slice(1);\r\n    }\r\n    if (nodes[0].kind === DocNodeKind.FencedCode) {\r\n      result[key] = (nodes[0] as DocFencedCode).code.trim();\r\n    } else {\r\n      result[key] = nodesToMarkdown(nodes);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction getTsDoc(node: ts.Node) {\r\n  const sourceText = node.getSourceFile().getFullText();\r\n  const commentRanges = ts\r\n    .getLeadingCommentRanges(sourceText, node.pos)\r\n    ?.filter(({ pos }) => sourceText.substring(pos, pos + 3) === '/**');\r\n  if (!commentRanges || commentRanges.length === 0) {\r\n    return undefined;\r\n  }\r\n  if (commentRanges.length !== 1) {\r\n    throw new Error('Node had more than one doc comment');\r\n  }\r\n  const commentRange = commentRanges[0];\r\n  const parser = new TSDocParser(TSDOC_CONFIG);\r\n  return parser.parseString(\r\n    sourceText.substring(commentRange.pos, commentRange.end),\r\n  ).docComment;\r\n}\r\n\r\nfunction isHidden(docs: DocComment | undefined): boolean {\r\n  if (docs?.deprecatedBlock) {\r\n    return true;\r\n  }\r\n\r\n  // If we want to add types but not document them, say because it is an\r\n  // experimental feature, we can add `@privateRemarks hidden` to the relevant\r\n  // TSDoc section.\r\n  if (docs?.privateRemarks) {\r\n    return !!containerToMarkdown(docs.privateRemarks?.content).includes(\r\n      'hidden',\r\n    );\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction isBuiltInType(type: ts.Type): boolean {\r\n  return !!type.symbol?.declarations?.some(\r\n    (d) => d.getSourceFile().hasNoDefaultLib,\r\n  );\r\n}\r\n\r\nfunction isForeignType(type: ts.Type): boolean {\r\n  return !!type.symbol?.declarations?.some((d) =>\r\n    d.getSourceFile().fileName.includes('/node_modules/'),\r\n  );\r\n}\r\n\r\nfunction isFromBuiltInType(symbol: ts.Symbol): boolean {\r\n  return !!symbol.declarations?.some(\r\n    (d) => d.parent.getSourceFile().hasNoDefaultLib,\r\n  );\r\n}\r\n\r\nconst UTILITY_TYPES = ['Partial', 'Required', 'Readonly', 'Pick', 'Omit'];\r\n\r\n/**\r\n * Returns whether the given type is a built-in utility type that doesn't supply\r\n * any properties itself and just modifies another type.  See\r\n * https://www.typescriptlang.org/docs/handbook/utility-types.html.\r\n */\r\nfunction isUtilityType(type: ts.Type): boolean {\r\n  return !!(\r\n    isBuiltInType(type) &&\r\n    type.aliasSymbol &&\r\n    UTILITY_TYPES.includes(type.aliasSymbol.name)\r\n  );\r\n}\r\n\r\nfunction isUnion(type: ts.Type): type is ts.UnionType {\r\n  return !!(type.flags & ts.TypeFlags.Union);\r\n}\r\n\r\nfunction isStringLiteral(type: ts.Type): type is ts.StringLiteralType {\r\n  return !!(type.flags & ts.TypeFlags.StringLiteral);\r\n}\r\n\r\nfunction isBooleanLiteral(type: ts.Type): boolean {\r\n  return !!(type.flags & ts.TypeFlags.BooleanLiteral);\r\n}\r\n\r\nfunction isPrimitiveType(type: ts.Type): boolean {\r\n  return !!(\r\n    type.flags &\r\n    (ts.TypeFlags.String |\r\n      ts.TypeFlags.Number |\r\n      ts.TypeFlags.Boolean |\r\n      ts.TypeFlags.Null |\r\n      ts.TypeFlags.Undefined)\r\n  );\r\n}\r\n\r\nfunction isObject(type: ts.Type): type is ts.ObjectType {\r\n  return !!(type.flags & ts.TypeFlags.Object);\r\n}\r\n\r\nfunction isIntersection(type: ts.Type): type is ts.IntersectionType {\r\n  return !!(type.flags & ts.TypeFlags.Intersection);\r\n}\r\n\r\nfunction isFunction(type: ts.Type): boolean {\r\n  return type.getCallSignatures().length > 0;\r\n}\r\n\r\nfunction isArray(type: ts.Type): type is ts.TypeReference {\r\n  return (\r\n    isObject(type) &&\r\n    type.getSymbol()?.getName() === 'Array' &&\r\n    !!(type.objectFlags & ts.ObjectFlags.Reference)\r\n  );\r\n}\r\n\r\nfunction isTuple(type: ts.Type): type is ts.TypeReference {\r\n  return (\r\n    isObject(type) &&\r\n    !!(type.objectFlags & ts.ObjectFlags.Reference) &&\r\n    !!((type as ts.TypeReference).target.objectFlags & ts.ObjectFlags.Tuple)\r\n  );\r\n}\r\n\r\nfunction isUndefined(type: ts.Type): boolean {\r\n  return !!(type.flags & ts.TypeFlags.Undefined);\r\n}\r\n\r\nfunction isOptional(symbol: ts.Symbol): boolean {\r\n  return !!(symbol.flags & ts.SymbolFlags.Optional);\r\n}\r\n\r\nfunction isMethod(symbol: ts.Symbol): boolean {\r\n  return !!(symbol.flags & ts.SymbolFlags.Method);\r\n}\r\n\r\nfunction isProperty(symbol: ts.Symbol): boolean {\r\n  return !!(symbol.flags & ts.SymbolFlags.Property);\r\n}\r\n\r\nfunction typeForSymbol(\r\n  symbol: ts.Symbol,\r\n  typeChecker: ts.TypeChecker,\r\n): [ts.Type, DocComment | undefined] {\r\n  if (symbol.declarations?.[0]) {\r\n    return [\r\n      typeChecker.getTypeOfSymbolAtLocation(symbol, symbol.declarations[0]),\r\n      getTsDoc(symbol.declarations[0]),\r\n    ];\r\n  } else {\r\n    return [typeChecker.getTypeOfSymbol(symbol), undefined];\r\n  }\r\n}\r\n\r\nfunction typeDetails(\r\n  type: ts.Type,\r\n  typeChecker: ts.TypeChecker,\r\n  options: { removeUndefined?: boolean } = {},\r\n): Writeable<AnyOf | Property> {\r\n  return typeDetailsInternal(type, typeChecker, new Set(), options);\r\n}\r\n\r\nfunction typeDetailsInternal(\r\n  type: ts.Type,\r\n  typeChecker: ts.TypeChecker,\r\n  seenTypes: Set<ts.Type>,\r\n  options: { removeUndefined?: boolean } = {},\r\n): Writeable<AnyOf | Property> {\r\n  if (seenTypes.has(type)) {\r\n    // If we are evaluating a type and see that type again, we don't want to\r\n    // infinitely recurse, so just emit the type's name and quit\r\n    return {\r\n      type: typeChecker.typeToString(type),\r\n    };\r\n  }\r\n  const originalType = type;\r\n  try {\r\n    seenTypes.add(originalType);\r\n    if (options.removeUndefined) {\r\n      if (isUnion(type)) {\r\n        const undefinedIndex = type.types.findIndex(isUndefined);\r\n        if (undefinedIndex > -1) {\r\n          if (type.types.length === 2) {\r\n            type = type.types[1 - undefinedIndex];\r\n          } else {\r\n            type = {\r\n              ...type,\r\n              types: type.types.filter((t) => !isUndefined(t)),\r\n            } as ts.UnionType;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // I have no idea why, but sometimes the TS compiler outputs booleans as\r\n    // `true | false` rather than `boolean`, so replace those\r\n    if (isUnion(type) && type.types.filter(isBooleanLiteral).length === 2) {\r\n      if (type.types.length === 2) {\r\n        return {\r\n          type: 'boolean',\r\n        };\r\n      }\r\n      type = {\r\n        ...type,\r\n        types: [\r\n          {\r\n            flags: ts.TypeFlags.Boolean,\r\n          },\r\n          ...type.types.filter((t) => !isBooleanLiteral(t)),\r\n        ],\r\n      } as ts.UnionType;\r\n    }\r\n    if (isUnion(type)) {\r\n      if (type.types.every(isStringLiteral)) {\r\n        // This is a string union, we express those as enums\r\n        return {\r\n          type: 'string',\r\n          enum: type.types.map((t) => t.value),\r\n        };\r\n      }\r\n      if (type.types.every(isPrimitiveType)) {\r\n        // A union of simple types, just put them in the array\r\n        return {\r\n          type: type.types.map((t) => typeChecker.typeToString(t)),\r\n        };\r\n      }\r\n      // At least one of the unioned types is more complicated, use an anyOf\r\n      return {\r\n        anyOf: type.types.map(\r\n          (t) =>\r\n            typeDetailsInternal(\r\n              t,\r\n              typeChecker,\r\n              seenTypes,\r\n            ) as Writeable<Property>,\r\n        ),\r\n      };\r\n    }\r\n    if (isArray(type)) {\r\n      return {\r\n        type: typeChecker.typeToString(type),\r\n        items: typeDetailsInternal(\r\n          typeChecker.getTypeArguments(type)[0],\r\n          typeChecker,\r\n          seenTypes,\r\n        ),\r\n      };\r\n    }\r\n    if (isTuple(type)) {\r\n      return {\r\n        type: typeChecker.typeToString(type),\r\n      };\r\n    }\r\n    if (\r\n      (isObject(type) || isIntersection(type)) &&\r\n      !isFunction(type) &&\r\n      (!(isBuiltInType(type) || isForeignType(type)) || isUtilityType(type)) &&\r\n      typeChecker.getPropertiesOfType(type).length > 0\r\n    ) {\r\n      const result: Writeable<PropertiesList> = {\r\n        properties: {},\r\n        propertyOrder: [],\r\n        required: [],\r\n      };\r\n      for (const prop of typeChecker.getPropertiesOfType(type)) {\r\n        const [propType, docs] = typeForSymbol(prop, typeChecker);\r\n        if (isHidden(docs)) {\r\n          continue;\r\n        }\r\n        result.properties[prop.getName()] = {\r\n          description: docs\r\n            ? containerToMarkdown(docs.summarySection, docs.customBlocks)\r\n            : undefined,\r\n          ...typeDetailsInternal(propType, typeChecker, seenTypes, {\r\n            removeUndefined: true,\r\n          }),\r\n        };\r\n        result.propertyOrder.push(prop.getName());\r\n        if (!isOptional(prop)) {\r\n          result.required!.push(prop.getName());\r\n        }\r\n      }\r\n      const typeToString = typeChecker.typeToString(type);\r\n      return {\r\n        // If typeToString starts with a brace, it doesn't have a name and it's\r\n        // just outputting the structure, so call it 'object'\r\n        type: typeToString.startsWith('{') ? 'object' : typeToString,\r\n        ...result,\r\n      };\r\n    }\r\n    return {\r\n      type: typeChecker.typeToString(type),\r\n    };\r\n  } finally {\r\n    seenTypes.delete(originalType);\r\n  }\r\n}\r\n\r\nfunction extractParameters(\r\n  declaration: ts.SignatureDeclaration,\r\n  typeChecker: ts.TypeChecker,\r\n): Writeable<PropertiesList> {\r\n  const result: Writeable<PropertiesList> = {\r\n    propertyOrder: [],\r\n    required: [],\r\n    properties: {},\r\n  };\r\n  const paramDocs = getTsDoc(declaration)?.params;\r\n  for (const parameter of declaration.parameters) {\r\n    const name = (parameter.name as ts.Identifier).getText();\r\n    const optional = typeChecker.isOptionalParameter(parameter);\r\n    const docBlock = paramDocs?.tryGetBlockByName(name);\r\n    result.properties[name] = {\r\n      description: docBlock ? containerToMarkdown(docBlock.content) : undefined,\r\n      ...typeDetails(typeChecker.getTypeAtLocation(parameter), typeChecker, {\r\n        removeUndefined: optional,\r\n      }),\r\n    };\r\n    result.propertyOrder.push(name);\r\n    if (!optional) {\r\n      result.required?.push(name);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction extractSingleFunctionDeclaration(\r\n  node: ts.Symbol,\r\n  declaration: ts.SignatureDeclaration,\r\n  typeChecker: ts.TypeChecker,\r\n): Writeable<SingleMethod> | undefined {\r\n  const docs = getTsDoc(declaration);\r\n  if (!docs) {\r\n    return undefined;\r\n  }\r\n  const signature = typeChecker.getSignatureFromDeclaration(declaration)!;\r\n  return {\r\n    name: node.getName(),\r\n    summary: containerToMarkdown(docs.summarySection),\r\n    examples: extractExamples(docs.customBlocks),\r\n    parameters: extractParameters(declaration, typeChecker),\r\n    returns: {\r\n      description: docs.returnsBlock\r\n        ? containerToMarkdown(docs.returnsBlock.content)\r\n        : undefined,\r\n      ...typeDetails(signature.getReturnType(), typeChecker),\r\n    },\r\n  };\r\n}\r\n\r\nfunction extractFunction(\r\n  symbol: ts.Symbol,\r\n  typeChecker: ts.TypeChecker,\r\n): Writeable<Method> | undefined {\r\n  const declarations = (symbol.getDeclarations() ?? []).filter(\r\n    (d): d is ts.FunctionDeclaration | ts.MethodSignature =>\r\n      ts.isFunctionDeclaration(d) || ts.isMethodSignature(d),\r\n  );\r\n  if (declarations.length === 0) {\r\n    return undefined;\r\n  }\r\n  if (declarations.length === 1) {\r\n    return extractSingleFunctionDeclaration(\r\n      symbol,\r\n      declarations[0],\r\n      typeChecker,\r\n    );\r\n  } else {\r\n    return {\r\n      overloaded: true,\r\n      overloads: declarations\r\n        .filter((d) => ts.isMethodSignature(d) || !d.body)\r\n        .map((declaration) =>\r\n          extractSingleFunctionDeclaration(symbol, declaration, typeChecker),\r\n        )\r\n        .filter(isDefined),\r\n    };\r\n  }\r\n}\r\n\r\nfunction extractModule(\r\n  moduleSymbol: ts.Symbol,\r\n  typeChecker: ts.TypeChecker,\r\n): Namespace {\r\n  const result: Namespace = {};\r\n  typeChecker.getExportsOfModule(moduleSymbol).forEach((exported) => {\r\n    switch (exported.flags) {\r\n      case ts.SymbolFlags.Alias: {\r\n        const aliased = typeChecker.getAliasedSymbol(exported);\r\n        switch (aliased.flags) {\r\n          case ts.SymbolFlags.ValueModule:\r\n            result[exported.getName()] = extractModule(aliased, typeChecker);\r\n            break;\r\n          case ts.SymbolFlags.Interface:\r\n            processInterface(aliased, typeChecker, result);\r\n            break;\r\n        }\r\n        break;\r\n      }\r\n      case ts.SymbolFlags.Interface:\r\n      case ts.SymbolFlags.TypeAlias: {\r\n        processInterface(exported, typeChecker, result);\r\n        break;\r\n      }\r\n      case ts.SymbolFlags.Function: {\r\n        const method = extractFunction(exported, typeChecker);\r\n        if (method) {\r\n          result[exported.getName()] = method;\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nfunction processInterface(\r\n  exported: ts.Symbol,\r\n  typeChecker: ts.TypeChecker,\r\n  result: Namespace,\r\n): void {\r\n  const ifaceData: Writeable<Interface> = {\r\n    name: exported.getName(),\r\n    methods: { methodOrder: [], required: [], methods: {} },\r\n    properties: {\r\n      properties: {},\r\n      propertyOrder: [],\r\n      required: [],\r\n    },\r\n  };\r\n  const type = typeChecker.getDeclaredTypeOfSymbol(exported);\r\n  for (const member of typeChecker.getPropertiesOfType(type)) {\r\n    if (isFromBuiltInType(member)) {\r\n      continue;\r\n    }\r\n    if (isProperty(member)) {\r\n      const [memberType, docs] = typeForSymbol(member, typeChecker);\r\n      if (isHidden(docs)) {\r\n        continue;\r\n      }\r\n      ifaceData.properties.properties[member.getName()] = {\r\n        ...typeDetails(memberType, typeChecker, {\r\n          removeUndefined: isOptional(member),\r\n        }),\r\n        description: docs\r\n          ? containerToMarkdown(docs.summarySection, docs.customBlocks)\r\n          : undefined,\r\n      };\r\n      ifaceData.properties.propertyOrder.push(member.getName());\r\n      if (!isOptional(member)) {\r\n        ifaceData.properties.required!.push(member.getName());\r\n      }\r\n    } else if (isMethod(member)) {\r\n      const method = extractFunction(member, typeChecker);\r\n      if (method) {\r\n        ifaceData.methods.methods[member.getName()] = method;\r\n        ifaceData.methods.methodOrder.push(member.getName());\r\n        if (!isOptional(member)) {\r\n          ifaceData.methods.required.push(member.getName());\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // Don't bother outputting any types that are uninteresting\r\n  if (\r\n    Object.keys(ifaceData.methods.methods).length > 0 ||\r\n    Object.keys(ifaceData.properties.properties).length > 0\r\n  ) {\r\n    result[exported.getName()] = ifaceData;\r\n  }\r\n}\r\n\r\nfunction packageToPath(sdkPackage: string): string {\r\n  return path.resolve(`opensource/sdk-js/packages/${sdkPackage}/index.ts`);\r\n}\r\n\r\nfunction extractPackage(sdkPackage: string, tsProgram: ts.Program): Namespace {\r\n  const typeChecker = tsProgram.getTypeChecker();\r\n  const sourceFile = tsProgram.getSourceFile(packageToPath(sdkPackage))!;\r\n  return extractModule(\r\n    typeChecker.getSymbolAtLocation(sourceFile)!,\r\n    typeChecker,\r\n  );\r\n}\r\n\r\nconst PACKAGES = [\r\n  'types',\r\n  'react',\r\n  'chatbot-base',\r\n  'chatbot-anthropic',\r\n  'chatbot-openai',\r\n];\r\n\r\nconst main = async () => {\r\n  // Compile the code\r\n\r\n  const tsCompilerHost = {\r\n    ...ts.createCompilerHost({}),\r\n\r\n    // make sure we don't write files\r\n    writeFile: () => {},\r\n\r\n    // don't give it access to any directories\r\n    getDirectories: () => [],\r\n  };\r\n  const tsProgram = ts.createProgram(\r\n    PACKAGES.map(packageToPath),\r\n    {\r\n      target: ts.ScriptTarget.ES2021,\r\n      moduleResolution: ts.ModuleResolutionKind.NodeJs,\r\n      strictNullChecks: true,\r\n    },\r\n    tsCompilerHost,\r\n  );\r\n\r\n  // Extract the TSDoc for the docs\r\n\r\n  const schemaOut = Object.fromEntries(\r\n    PACKAGES.map((p) => [p, extractPackage(p, tsProgram)]),\r\n  );\r\n\r\n  console.log(\r\n    await prettier.format(\r\n      `\r\n// @generated\r\n// npm run docs-codegen\r\n/* eslint-disable */\r\nexport default ${JSON.stringify(schemaOut)} as const;`,\r\n      { filepath: 'out.ts', ...(await prettier.resolveConfig('out.ts')) },\r\n    ),\r\n  );\r\n};\r\n\r\nPromise.resolve(main()).catch((err) => {\r\n  console.error(err);\r\n  process.exit(1);\r\n});\r\n", "import md5 from 'blueimp-md5';\r\nimport jsonStableStringify from 'fast-json-stable-stringify';\r\nimport { unique } from 'radash';\r\nimport shajs from 'sha.js';\r\nimport dayjs from 'dayjs';\r\nimport Calendar from 'dayjs/plugin/calendar.js';\r\nimport isBetween from 'dayjs/plugin/isBetween.js';\r\n\r\nimport type {\r\n  UUID,\r\n  MessageContent,\r\n  ReferencedUserData,\r\n} from 'common/types/index.ts';\r\nimport { MessageNodeType } from 'common/types/index.ts';\r\nimport {\r\n  CORD_PLATFORM_ORG_ID,\r\n  CORD_ADMIN_PLATFORM_ORG_ID,\r\n  GILLIAN_TEST_SLACK_ORG_ID,\r\n  RADICAL_ORG_ID,\r\n  RADICAL_TEST_ORG_ID,\r\n  KAT_TEST_SLACK_ORG_ID,\r\n  CORD_SLACK_TEAM_ID,\r\n  CORD_TEST_SLACK_TEAM_ID,\r\n} from 'common/const/Ids.ts';\r\nimport {\r\n  getMessageNodeChildren,\r\n  textFromNodeRecursive,\r\n} from '@cord-sdk/react/common/lib/messageNode.ts';\r\nimport { trimStart } from '@cord-sdk/react/common/lib/trim.ts';\r\n\r\nconst uuidRegex =\r\n  /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;\r\n\r\nexport const isEmployee = (orgID: UUID | undefined) =>\r\n  orgID === RADICAL_ORG_ID ||\r\n  orgID === RADICAL_TEST_ORG_ID ||\r\n  orgID === CORD_PLATFORM_ORG_ID ||\r\n  orgID === GILLIAN_TEST_SLACK_ORG_ID ||\r\n  orgID === KAT_TEST_SLACK_ORG_ID ||\r\n  orgID === CORD_ADMIN_PLATFORM_ORG_ID ||\r\n  process.env.NODE_ENV === 'development';\r\n\r\nexport const isInternalSlackOrg = (slackTeamID: string | undefined) =>\r\n  slackTeamID === CORD_SLACK_TEAM_ID || slackTeamID === CORD_TEST_SLACK_TEAM_ID;\r\n\r\nexport const assertUUID = (value: string): UUID => {\r\n  if (!uuidRegex.test(value)) {\r\n    throw new Error(`Invalid UUID ${value}`);\r\n  } else {\r\n    return value;\r\n  }\r\n};\r\n\r\n/**\r\n * @deprecated MD5 is no longer secure, use sha256Hash instead.\r\n */\r\nexport function md5Hash(object: boolean | number | string | object) {\r\n  return md5(jsonStableStringify(object));\r\n}\r\n\r\nexport function sha256Hash(value: string) {\r\n  return shajs('sha256').update(value).digest('hex');\r\n}\r\nexport const SHA256_HASH_LENGTH = 64;\r\n\r\nexport function generateSalt() {\r\n  const buf = new Uint8Array(8);\r\n  crypto.getRandomValues(buf);\r\n  return Array.from(buf)\r\n    .map((b) => b.toString(16).padStart(2, '0'))\r\n    .join('');\r\n}\r\n\r\nexport function sha256HashAndSalt(\r\n  value: string,\r\n  salt: string = generateSalt(),\r\n) {\r\n  return 'sha256' + ':' + salt + ':' + sha256Hash(salt + ':' + value);\r\n}\r\n\r\nexport function prepareTextContent(textContent: string) {\r\n  return (\r\n    textContent\r\n      .trim()\r\n      .toLowerCase()\r\n      // Remove Zero Width No-Break Space (U+FEFF)\r\n      .replace(/[\\uFEFF\\n]/gm, '')\r\n  );\r\n}\r\n\r\nexport function doesTextQualify(text: string | undefined | null) {\r\n  return Boolean(text && text.length > 1 && text.trim());\r\n}\r\n\r\nexport function getSha256Salt(hash: string): string {\r\n  return hash?.split(':')[1] ?? '';\r\n}\r\n\r\nexport function matchesHash(value: string, hashWithSalt: string) {\r\n  return hashWithSalt === sha256HashAndSalt(value, getSha256Salt(hashWithSalt));\r\n}\r\n\r\nexport function isNotNull<T>(value: T | null): value is T {\r\n  return value !== null;\r\n}\r\n\r\nexport function isDefined<T>(value: T | null | undefined): value is T {\r\n  return value !== null && value !== undefined;\r\n}\r\n\r\nexport function getMentionedUserIDs(content: MessageContent): UUID[] {\r\n  let users: UUID[] = [];\r\n  for (const node of content) {\r\n    if (node.type === MessageNodeType.MENTION) {\r\n      users.push(node.user.id);\r\n    } else {\r\n      const children = getMessageNodeChildren(node);\r\n      if (children) {\r\n        users = [...users, ...getMentionedUserIDs(children)];\r\n      }\r\n    }\r\n  }\r\n\r\n  return unique(users);\r\n}\r\n\r\nexport function getReferencedUserIDs(content: MessageContent): UUID[] {\r\n  const accumulator = new Set<UUID>();\r\n  gatherReferencedUserIDs(content, accumulator);\r\n  return [...accumulator];\r\n}\r\n\r\nfunction gatherReferencedUserIDs(\r\n  nodes: MessageContent,\r\n  accumulator: Set<UUID>,\r\n) {\r\n  for (const node of nodes) {\r\n    if (\r\n      node.type === MessageNodeType.MENTION ||\r\n      node.type === MessageNodeType.ASSIGNEE\r\n    ) {\r\n      accumulator.add(node.user.id);\r\n      continue;\r\n    }\r\n    const children = getMessageNodeChildren(node);\r\n    if (children) {\r\n      gatherReferencedUserIDs(children, accumulator);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getReferencedUserIDsAndNames(\r\n  content: MessageContent,\r\n): ReferencedUserData[] {\r\n  const accumulator = new Map<UUID, string>();\r\n  gatherReferencedUserIDsAndName(content, accumulator);\r\n  return [...accumulator].map(([id, name]) => ({ id, name }));\r\n}\r\n\r\nfunction gatherReferencedUserIDsAndName(\r\n  nodes: MessageContent,\r\n  accumulator: Map<UUID, string>,\r\n) {\r\n  for (const node of nodes) {\r\n    if (\r\n      node.type === MessageNodeType.MENTION ||\r\n      node.type === MessageNodeType.ASSIGNEE\r\n    ) {\r\n      const userID = node.user.id;\r\n      const name = trimStart(textFromNodeRecursive(node), '@');\r\n      accumulator.set(userID, name);\r\n      continue;\r\n    }\r\n    const children = getMessageNodeChildren(node);\r\n    if (children) {\r\n      gatherReferencedUserIDsAndName(children, accumulator);\r\n    }\r\n  }\r\n}\r\n\r\n// JS replaceAll not well supported yet: https://caniuse.com/?search=replaceAll\r\nexport function replaceAll(str: string, replace: string, replaceWith: string) {\r\n  return str.split(replace).join(replaceWith);\r\n}\r\n\r\nexport type UserWithNames = {\r\n  displayName: string;\r\n  fullName: string;\r\n};\r\n\r\nexport type DisplayableUser = UserWithNames & {\r\n  id: UUID;\r\n  profilePictureURL: string | null;\r\n};\r\n\r\nexport function assert(predicate: boolean, message: string): asserts predicate {\r\n  if (!predicate) {\r\n    throw new Error(message);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the supplied items using the specified combiner.\r\n *\r\n * @example\r\n * // Returns \"foo, bar, or baz\"\r\n * combine(\"or\", [\"foo\", \"bar\", \"baz\"])\r\n */\r\nexport function combine(combiner: string, items: string[]): string {\r\n  if (items.length === 0) {\r\n    return '';\r\n  } else if (items.length === 1) {\r\n    return items[0];\r\n  } else if (items.length === 2) {\r\n    return `${items[0]} ${combiner} ${items[1]}`;\r\n  } else {\r\n    return `${items.slice(0, -1).join(', ')}, ${combiner} ${\r\n      items[items.length - 1]\r\n    }`;\r\n  }\r\n}\r\n\r\nexport const CORD_DEEP_LINK_THREAD_QUERY_PARAM = 'cord_thread';\r\nexport const CORD_DEEP_LINK_MESSAGE_QUERY_PARAM = 'cord_message';\r\nexport const CORD_DEEP_LINK_QUERY_PARAM = 'cord_link';\r\n\r\nexport const CORD_ARGS_TO_REMOVE = [\r\n  // delete deeplinking query params from urls. We dont want them as part of\r\n  // the pageContext\r\n\r\n  // old deeplinking query params. Keep here to support old deeplinks.\r\n  CORD_DEEP_LINK_THREAD_QUERY_PARAM,\r\n  CORD_DEEP_LINK_MESSAGE_QUERY_PARAM,\r\n\r\n  // new (unified) deeplinking query param\r\n  CORD_DEEP_LINK_QUERY_PARAM,\r\n];\r\n\r\nexport function extractDeepLinkQueryParams(\r\n  url: string,\r\n): { threadID: UUID; messageID: UUID } | null {\r\n  try {\r\n    const parsed = new URL(url);\r\n    return extractDeepLinkQueryParamsV1(parsed);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\n// also see injectDeeplinkQueryParamsV1()\r\nfunction extractDeepLinkQueryParamsV1(\r\n  url: URL,\r\n): { threadID: UUID; messageID: UUID } | null {\r\n  const [version, threadID, messageID]: (string | undefined)[] = (\r\n    url.searchParams.get(CORD_DEEP_LINK_QUERY_PARAM) ?? ''\r\n  ).split('_');\r\n\r\n  if (version !== 'v1' || !threadID || !messageID) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    threadID,\r\n    messageID,\r\n  };\r\n}\r\n\r\ndayjs.extend(Calendar);\r\ndayjs.extend(isBetween);\r\n\r\nfunction getNowTimestamp() {\r\n  return dayjs(new Date(Date.now()));\r\n}\r\n\r\nexport function isTimestampTodayOrInTheFuture(timestamp: string) {\r\n  const now = getNowTimestamp();\r\n  return (\r\n    dayjs(timestamp).isSame(dayjs(now), 'day') ||\r\n    dayjs(timestamp).isAfter(dayjs(now), 'day')\r\n  );\r\n}\r\n\r\nexport function isTimestampFromPastSevenDays(timestamp: string) {\r\n  const now = getNowTimestamp();\r\n  const sevenDaysBefore = now.subtract(7, 'day');\r\n\r\n  return (\r\n    dayjs(timestamp).isBetween(now, sevenDaysBefore, 'day') ||\r\n    dayjs(timestamp).isSame(sevenDaysBefore, 'date')\r\n  );\r\n}\r\n\r\nexport function isTimestampFromPastThirtyDays(timestamp: string) {\r\n  const now = getNowTimestamp();\r\n  const thirtyDaysBefore = now.subtract(30, 'day');\r\n\r\n  return (\r\n    dayjs(timestamp).isBetween(now, thirtyDaysBefore) ||\r\n    dayjs(timestamp).isSame(thirtyDaysBefore, 'date')\r\n  );\r\n}\r\n\r\nexport function isTimestampFromPastThreeMonths(timestamp: string) {\r\n  const now = getNowTimestamp();\r\n  const threeMonthsBefore = now.subtract(3, 'month');\r\n  return (\r\n    dayjs(timestamp).isBetween(now, threeMonthsBefore) ||\r\n    dayjs(timestamp).isSame(threeMonthsBefore, 'day')\r\n  );\r\n}\r\n\r\nexport function isTimestampFromPastYear(timestamp: string) {\r\n  const now = getNowTimestamp();\r\n  const pastYear = now.subtract(1, 'year');\r\n  return (\r\n    dayjs(timestamp).isBetween(now, pastYear) ||\r\n    dayjs(timestamp).isSame(pastYear, 'day')\r\n  );\r\n}\r\n\r\nexport function isTimestampMoreThanAYearAgo(timestamp: string) {\r\n  const now = getNowTimestamp();\r\n  const pastYear = now.subtract(1, 'year');\r\n  return dayjs(timestamp).isBefore(pastYear, 'day');\r\n}\r\n\r\nexport function createDefaultSenderEmailName(applicationName: string) {\r\n  return applicationName.toLowerCase().split(/\\W/).join('') + '-notifications';\r\n}\r\n\r\n/**\r\n * in both the console UI and the API we don't allow editing the whole sender\r\n * field on customEmailTemplate, but only specific parts of it. This function\r\n * takes a 'sender' input and returns parts of the email.\r\n *\r\n * @example\r\n * const input = 'Cord <hello@cord.com>';\r\n * getEmailInfoFromSenderData(input); // {emailAddress: \"hello@cord.com\", domain: \"cord.com\", username: \"hello\" }\r\n */\r\ntype SenderInfo = {\r\n  domain: string;\r\n  emailAddress: string;\r\n  username: string;\r\n};\r\nexport function getEmailInfoFromSenderData(\r\n  sender?: string,\r\n): SenderInfo | undefined {\r\n  if (!sender) {\r\n    return undefined;\r\n  }\r\n\r\n  const mentionMatchingPattern = new RegExp(\r\n    '(<)' + // first match a \"<\"\r\n      '([^@]+)' + // then match anything that's not an @ symbol and is at least 1 char\r\n      '(@)' + // then match the @ so we can just access the domain itself easily\r\n      '([^>]+)', // then match anything that's not an > symbol and is at least 1 char\r\n    'gm',\r\n  );\r\n\r\n  let info: SenderInfo | undefined = undefined;\r\n  let match: RegExpExecArray | null;\r\n\r\n  while ((match = mentionMatchingPattern.exec(sender))) {\r\n    info = {\r\n      username: match[2],\r\n      domain: match[4],\r\n      emailAddress: match[0].substring(1),\r\n    };\r\n  }\r\n\r\n  return info;\r\n}\r\n\r\nexport function capitalizeFirstLetter(string: string) {\r\n  return string.charAt(0).toUpperCase() + string.slice(1);\r\n}\r\n", "// See #8935:\r\n/// <reference lib=\"es2022\" />\r\n\r\nimport type OpenAI from 'openai';\r\n\r\nimport jsonStableStringify from 'fast-json-stable-stringify';\r\nimport type { Placement } from '@floating-ui/react-dom';\r\nimport { isEqual } from '@cord-sdk/react/common/lib/fast-deep-equal.ts';\r\n\r\nexport type {\r\n  DocumentAnnotationResult,\r\n  Screenshot,\r\n  DocumentLocation,\r\n  LocationTextConfig,\r\n  HighlightedTextConfig,\r\n  AdditionalTargetData,\r\n  Annotation,\r\n  AnnotationWithThreadID,\r\n  AnnotationCapturePosition,\r\n} from '@cord-sdk/types';\r\nexport { locationJson } from '@cord-sdk/types';\r\nimport { locationJson, MessageNodeType } from '@cord-sdk/types';\r\nimport type {\r\n  FlatJsonObject,\r\n  LocationFilterOptions,\r\n  ResolvedStatus,\r\n  MessageAnnotation,\r\n  ElementIdentifierVersion,\r\n  EntityMetadata,\r\n  NotificationListFilter,\r\n  ThreadListFilter,\r\n  JsonValue,\r\n  JsonObject,\r\n  MessageContent,\r\n  MessageNode,\r\n  ViewerThreadStatus,\r\n} from '@cord-sdk/types';\r\n\r\nexport type {\r\n  MessageAnnotation,\r\n  ElementIdentifierVersion,\r\n  EntityMetadata,\r\n  NotificationListFilter,\r\n  ThreadListFilter,\r\n  JsonValue,\r\n  JsonObject,\r\n};\r\n\r\nexport type SimpleTranslationParameters = FlatJsonObject;\r\n\r\nexport enum DataTableQueries {\r\n  ADMIN_USERS = 'admin_users',\r\n  SET_ADMIN = 'set_admin',\r\n  USER_DETAILS = 'user_details',\r\n  ORG_DETAILS = 'org_details',\r\n  APP_DETAILS = 'app_details',\r\n  THREAD_DETAILS = 'thread_details',\r\n  MESSAGE_DETAILS = 'message_details',\r\n  CUSTOMER_DETAILS = 'customer_details',\r\n  ORG_MEMBER_DETAILS = 'org_member_details',\r\n  ID_SEARCH = 'id_search',\r\n  PROD_APPLICATIONS = 'prod_applications',\r\n  STAGING_APPLICATIONS = 'staging_applications',\r\n  SAMPLE_APPLICATIONS = 'sample_applications',\r\n  VERIFIED_CUSTOMERS = 'verified_customers',\r\n  SAMPLE_CUSTOMERS = 'sample_customers',\r\n  DEPLOYS = 'deploys',\r\n  PAGE_CONTEXTS = 'page_contexts',\r\n  BROWSER_METRICS = 'browser_metrics',\r\n  OS_METRICS = 'os_metrics',\r\n  GO_REDIRECTS = 'go_redirects',\r\n}\r\n\r\nexport type NonNullableKeys<T, K extends keyof T> = T & {\r\n  [P in K]: NonNullable<T[P]>;\r\n};\r\n\r\nexport type NullableKeys<T, K extends keyof T> = Omit<T, K> & {\r\n  [P in K]: T[P] | null;\r\n};\r\n\r\nexport type ElementOf<T extends Array<any>> = T[number];\r\n\r\n/**\r\n * A mapping type that effectively combines Required<T> and NonNullable<T> to\r\n * turn { foo?: string | undefined } into { foo: string }\r\n */\r\n// NOTE(9/9/2021): This is equivalent to Required<T> if we compiled with\r\n// --strictNullChecks, but we currently don't\r\nexport type ReallyRequired<T> = {\r\n  [P in keyof T]-?: NonNullable<T[P]>;\r\n};\r\n\r\nexport type { MessageContent, MessageNode };\r\nexport { MessageNodeType };\r\n\r\nexport type UUID = string;\r\n\r\nexport type Location = {\r\n  [k: string]: string | number | boolean;\r\n};\r\n\r\nexport type SortDirection = 'ascending' | 'descending';\r\n\r\nexport function isValidFlatJsonObject(obj: any): obj is FlatJsonObject {\r\n  if (!obj) {\r\n    return false;\r\n  }\r\n  if (typeof obj !== 'object' || Array.isArray(obj)) {\r\n    return false;\r\n  }\r\n  for (const [_, value] of Object.entries(obj)) {\r\n    const t = typeof value;\r\n    if (t !== 'string' && t !== 'number' && t !== 'boolean') {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isLocation(obj: any): obj is Location {\r\n  return isValidFlatJsonObject(obj);\r\n}\r\n\r\nexport function isValidMetadata(obj: any): obj is EntityMetadata {\r\n  return isValidFlatJsonObject(obj);\r\n}\r\n\r\nexport function toLocation(obj: any): Location | null {\r\n  return isLocation(obj) ? obj : null;\r\n}\r\n\r\n// We receive location as either Location or LocationFilterOptions from\r\n// our apis. Since Location type can be flat object with multiple properties\r\n// we have to check the property type to make sure we're getting the right value.\r\n// eg: {value: 'foo', ...} is Location\r\n// while {value: {value: 'foo'} ...} is LocationFilterOptions\r\nexport function getLocationFilter(\r\n  obj: LocationFilterOptions | Location | undefined,\r\n): LocationFilterOptions | undefined {\r\n  if (!obj) {\r\n    return undefined;\r\n  }\r\n\r\n  if (isLocation(obj)) {\r\n    return { value: obj, partialMatch: false };\r\n  }\r\n\r\n  if (isLocation(obj.value)) {\r\n    return obj;\r\n  }\r\n  return undefined;\r\n}\r\n\r\n// Function to convert our external resolvedStatus filter enum\r\n// to our internal 'resolved' boolean property\r\nexport function getResolvedFromStatus(\r\n  status: ResolvedStatus,\r\n): boolean | undefined {\r\n  // we've not included a fallback value as this will just increase the chances\r\n  // of returning the wrong data somewhere. So we make sure to pass whatever\r\n  // we've said the default is for the API that's calling this.\r\n  switch (status) {\r\n    case 'resolved': {\r\n      return true;\r\n    }\r\n    case 'unresolved': {\r\n      return false;\r\n    }\r\n    case 'any': {\r\n      return undefined;\r\n    }\r\n    default: {\r\n      const unhandledStatus: never = status;\r\n      throw new Error('Invalid resolved status type ' + unhandledStatus);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getViewerThreadFilter(\r\n  viewerStatus: ViewerThreadStatus | ViewerThreadStatus[] | undefined,\r\n): ViewerThreadStatus[] {\r\n  if (!viewerStatus) {\r\n    return [];\r\n  }\r\n  if (typeof viewerStatus === 'string') {\r\n    return [viewerStatus];\r\n  }\r\n  return viewerStatus;\r\n}\r\n\r\nexport function metadataMatches(\r\n  metadata: EntityMetadata,\r\n  matcher: EntityMetadata,\r\n): boolean {\r\n  for (const [key, value] of Object.entries(matcher)) {\r\n    if (metadata[key] !== value) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function locationMatches(context: Location, matcher: Location): boolean {\r\n  for (const [key, value] of Object.entries(matcher)) {\r\n    if (context[key] !== value) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction flatJsonObjectEqual(\r\n  a: FlatJsonObject | null,\r\n  b: FlatJsonObject | null,\r\n): boolean {\r\n  if (a === null && b === null) {\r\n    return true;\r\n  }\r\n  if (a === null || b === null) {\r\n    return false;\r\n  }\r\n  if (Object.keys(a).length !== Object.keys(b).length) {\r\n    return false;\r\n  }\r\n  for (const [key, value] of Object.entries(a)) {\r\n    if (b[key] !== value) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function locationEqual(a: Location | null, b: Location | null): boolean {\r\n  return flatJsonObjectEqual(a, b);\r\n}\r\n\r\nexport function metadataEqual(\r\n  a: EntityMetadata | null,\r\n  b: EntityMetadata | null,\r\n): boolean {\r\n  return flatJsonObjectEqual(a, b);\r\n}\r\n\r\n/**\r\n * Implements the canonical comparison for locations.  Currently, this sorts by\r\n * number of elements, then the JSON representation alphabetically, but we can\r\n * change that if we come up with something better.\r\n */\r\nexport function locationCompare(a: Location, b: Location): number {\r\n  const lengthA = Object.keys(a).length;\r\n  const lengthB = Object.keys(b).length;\r\n  if (lengthA !== lengthB) {\r\n    return lengthA - lengthB;\r\n  }\r\n  return locationJson(a).localeCompare(locationJson(b));\r\n}\r\n\r\nexport type PageContext = {\r\n  providerID: UUID | null;\r\n  data: Location;\r\n};\r\n\r\nexport function pageContextEqual(\r\n  a: PageContext | null,\r\n  b: PageContext | null,\r\n): boolean {\r\n  if (a === null && b === null) {\r\n    return true;\r\n  }\r\n  if (a === null || b === null) {\r\n    return false;\r\n  }\r\n  // Two contexts from different providers are never equal\r\n  if (a.providerID !== b.providerID) {\r\n    return false;\r\n  }\r\n  // If either has data, compare the data, otherwise compare the locations\r\n  return isEqual(a.data, b.data);\r\n}\r\n\r\n// This returns a string key that is equivalent from an equality perspective to\r\n// comparing the pageContexts.  Specifically, the intention is that\r\n// pageContextEqual(a, b) === (pageContextKey(a) === pageContextKey(b))\r\n\r\n// The functioning of this depends a lot on our specific logic of\r\n// building PageContexts, such that, for instance,\r\n// a.location === b.location => a.providerID === b.providerID.\r\n\r\n// It also needs to stay consistent with the logic in server/src/util/hash.ts.\r\nexport function pageContextKey(pageContext: PageContext): string {\r\n  return jsonStableStringify({\r\n    providerID: pageContext.providerID,\r\n    data: pageContext.data,\r\n  });\r\n}\r\n\r\n/**\r\n * Convert a PageContext-like object into an actual PageContext.\r\n *\r\n * The PageContext types that we exchange with GraphQL allow nullable fields to\r\n * be undefined as well. This function takes such objects and returns a valid\r\n * PageContext.\r\n */\r\ntype PageContextLike = {\r\n  providerID?: UUID | null;\r\n  data: Location;\r\n};\r\nexport function toPageContext(pageContext: PageContextLike): PageContext;\r\nexport function toPageContext(pageContext: null | undefined): null;\r\nexport function toPageContext(\r\n  pageContext: PageContextLike | null | undefined,\r\n): PageContext | null;\r\nexport function toPageContext(\r\n  pageContext: PageContextLike | null | undefined,\r\n): PageContext | null {\r\n  if (!pageContext) {\r\n    return null;\r\n  }\r\n  const { providerID, data } = pageContext;\r\n  if (!isLocation(data)) {\r\n    throw new Error('Invalid context');\r\n  }\r\n  return {\r\n    providerID: providerID ?? null,\r\n    data,\r\n  };\r\n}\r\n\r\nexport type OrgMemberState = 'active' | 'inactive' | 'deleted'; // must match the keys in OrgMemberStateEnumType\r\n\r\nexport type UserType = 'person' | 'bot'; // must match the keys in UserTypeEnumType\r\n\r\nexport type UserState = 'active' | 'deleted'; // must match the keys in UserStateEnumType\r\n\r\nexport type ImportedSlackMessageType = 'reply' | 'supportBotReply'; // must match the keys in ImportedSlackMessageTypeEnumType\r\n\r\nexport type MessageType = 'action_message' | 'user_message'; //must match the keys in MessageTypeEnumType\r\n\r\nexport interface Todo {\r\n  id: UUID;\r\n  done: boolean;\r\n}\r\n\r\nexport enum MessageAttachmentType {\r\n  FILE = 'file',\r\n  ANNOTATION = 'annotation',\r\n  SCREENSHOT = 'screenshot',\r\n}\r\n\r\nexport const MessageAnnotationAttachmentTypeName =\r\n  'MessageAnnotationAttachment';\r\n\r\nexport function parseElementIdentifierVersion(\r\n  val: string,\r\n): ElementIdentifierVersion | null {\r\n  if (val === '1' || val === '2') {\r\n    return val;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport enum ElementIdentifierMatch {\r\n  EXACT = 'exact',\r\n  PARTIAL = 'partial',\r\n  NONE = 'none',\r\n}\r\n\r\nexport enum LocationMatch {\r\n  EXACT = 'exact',\r\n  SIBLING = 'sibling',\r\n  MULTIMEDIA = 'multimedia',\r\n  CHART = 'chart',\r\n  STALE = 'stale',\r\n  MAYBE_STALE = 'maybe_stale',\r\n  NONE = 'none',\r\n  // User has old extension, and does not have the latest identifier version\r\n  INCOMPATIBLE_IDENTIFIER_VERSION = 'incompatible_identifier_version',\r\n  // Used if fallback document coordinates are included, and we don't have an exact/sibling match\r\n  DOCUMENT_COORDINATES = 'document_coordinates',\r\n  // If we weren't able to annotate, so we're instead relying on the screenshot\r\n  // Examples: annotating a pdf, annotating an iframe we can't access\r\n  UNAVAILABLE = 'unavailable',\r\n  // If the annotation was on an inaccessible cross-domain iframe. We want to\r\n  // show it while the message is being drafted, but not after it's been posted\r\n  INACCESSIBLE_CROSS_DOMAIN_IFRAME = 'inaccessible_cross_domain_iframe',\r\n  OUTSIDE_ACCESSIBLE_VIRTUALISED_LIST = 'outside_accessible_virtualised_list',\r\n  OUTSIDE_INACCESSIBLE_VIRTUALISED_LIST = 'outside_inaccessible_virtualised_list',\r\n}\r\n\r\nexport function annotationHasLocation(annotation: MessageAnnotation) {\r\n  return annotation.location !== null || annotation.customLocation !== null;\r\n}\r\n\r\nexport const ThreadCreatedTypeName = 'ThreadCreated';\r\nexport const ThreadMessageAddedTypeName = 'ThreadMessageAdded';\r\nexport const ThreadMessageUpdatedTypeName = 'ThreadMessageUpdated';\r\nexport const ThreadMessageContentAppendedTypeName =\r\n  'ThreadMessageContentAppended';\r\nexport const ThreadMessageRemovedTypeName = 'ThreadMessageRemoved';\r\nexport const ThreadParticipantsUpdatedIncrementalTypeName =\r\n  'ThreadParticipantsUpdatedIncremental';\r\nexport const ThreadTypingUsersUpdatedTypeName = 'ThreadTypingUsersUpdated';\r\nexport const ThreadShareToSlackTypeName = 'ThreadShareToSlack';\r\nexport const ThreadPropertiesUpdatedTypeName = 'ThreadPropertiesUpdated';\r\nexport const ThreadSubscriberUpdatedTypeName = 'ThreadSubscriberUpdated';\r\nexport const ThreadDeletedTypeName = 'ThreadDeleted';\r\n\r\nexport const PageThreadAddedTypeName = 'PageThreadAdded';\r\nexport const PageThreadDeletedTypename = 'PageThreadDeleted';\r\nexport const PageThreadReplyAddedTypeName = 'PageThreadReplyAdded';\r\nexport const PageVisitorsUpdatedTypeName = 'PageVisitorsUpdated';\r\nexport const PageThreadResolvedTypeName = 'PageThreadResolved';\r\nexport const PageThreadUnresolvedTypeName = 'PageThreadUnresolved';\r\nexport const ThreadFilterablePropertiesMatchTypeName =\r\n  'ThreadFilterablePropertiesMatch';\r\nexport const ThreadFilterablePropertiesUnmatchTypeName =\r\n  'ThreadFilterablePropertiesUnmatch';\r\n\r\nexport const NotificationAddedTypeName = 'NotificationAdded';\r\nexport const NotificationReadStateUpdatedTypeName =\r\n  'NotificationReadStateUpdated';\r\nexport const NotificationDeletedTypeName = 'NotificationDeleted';\r\n\r\nexport const OrgMemberAddedTypeName = 'OrgMemberAdded';\r\nexport const OrgMemberRemovedTypeName = 'OrgMemberRemoved';\r\n\r\nexport const ConsoleGettingStartedUpdatedTypeName =\r\n  'ConsoleGettingStartedUpdated';\r\n\r\nexport const CustomerSubscriptionUpdatedTypeName =\r\n  'CustomerSubscriptionUpdated';\r\n\r\nexport type FileAttachmentInput = {\r\n  id: UUID;\r\n  fileID: UUID;\r\n};\r\n\r\n// Subset of winston log levels, which can be found in NpmConfigSetLevels type in winston type file\r\nexport enum LogLevel {\r\n  ERROR = 'error',\r\n  WARN = 'warn',\r\n  INFO = 'info',\r\n  DEBUG = 'debug',\r\n}\r\n\r\nexport type PopperPosition = Placement;\r\n\r\n// called when the sidebar shows and hides, with a reference to the Cord iframe\r\n// expected to make domain-specific document adjustments to accommodate the sidebar\r\n// in its two states (expanded / not).\r\nexport type DocumentMutator = (width: number | null) => void;\r\n\r\n// called with the document to initialize any mutator-specific elements and behavior\r\n// expected to return the actual mutator function\r\nexport type DocumentMutatorInitializer = (\r\n  document: Document,\r\n) => DocumentMutator;\r\n\r\nexport type SimpleValue = string | number | boolean;\r\n\r\nexport type PreferencesValueType = JsonValue;\r\n\r\nexport type PreferencesType = JsonObject;\r\n\r\nexport enum UserReference {\r\n  MENTION = 'mention',\r\n  ASSIGNEE = 'assignee',\r\n}\r\n\r\nexport type RuleProviderInfo = {\r\n  id: UUID; // the ID of the provider, should be unique among providers\r\n  name: string; // the name of the provider\r\n  iconURL?: string | null; // URL for a favicon-like image\r\n  nuxText?: string | null; // the text to show the user teaching them how to use Radical on this specific provider\r\n  disableAnnotations?: boolean; // if annotations should be disabled for this provider. example: slack static PDFs where due to the chrome pdf viewer we don't have access to the scroll position\r\n};\r\n\r\n// a ruleset provider should export all the rules specific to a SaaS, even when\r\n// those rules span across different domain names.\r\nexport type RuleProvider = RuleProviderInfo & {\r\n  domains: string[]; // the domains that this provider's rules cover\r\n  rules: ProviderRule[]; // deny and approve rules\r\n  mergeHashWithLocation?: boolean; // a fix for providers like Snowflake who have URLs with query parameters after the # in the URL\r\n  visibleInDiscoverToolsSection: boolean; // the state of wether the tool is visible in th Discover tools section in the NUX flow, i.e. internal tools should not be included, localhost should not be included\r\n  platformApplicationID: UUID | null; // Application ID of provider, if relevant\r\n\r\n  // the functions to call to mutate the document to make room for the sidebar.\r\n  // this is a list to allow per-domain granularity.\r\n  documentMutators: ProviderDocumentMutator[];\r\n};\r\n\r\nexport type ProviderRule = {\r\n  id: UUID;\r\n  type: ProviderRuleType;\r\n  matchPatterns: ProviderRuleMatchPatterns;\r\n  nameTemplate: string | null;\r\n  contextTransformation: PageContextTransformation;\r\n  observeDOMMutations: boolean;\r\n};\r\n\r\nexport type ProviderDocumentMutator =\r\n  | { id: UUID; type: 'default_css'; config: CSSMutatorConfig }\r\n  | { id: UUID; type: 'custom_css'; config: CSSMutatorConfig }\r\n  | { id: UUID; type: 'fixed_elements'; config: null };\r\n\r\nexport type ProviderDocumentMutatorType = ProviderDocumentMutator['type'];\r\n\r\nexport type CSSMutatorConfig = {\r\n  cssTemplate: string;\r\n};\r\n\r\nexport type ProviderRuleType = 'allow' | 'deny';\r\n\r\nexport type ProviderRuleMatchPatterns = {\r\n  protocol?: string;\r\n  domain?: string;\r\n  path?: string;\r\n  hash?: string;\r\n  queryParams?: { [key: string]: string };\r\n  selector?: string;\r\n  contains?: string;\r\n};\r\n\r\nexport type ProviderRuleTestMatchType = 'allow' | 'deny' | 'none';\r\n\r\nexport type PageDetails = {\r\n  pageContext: PageContext;\r\n  pageName: string | null;\r\n};\r\n\r\nexport type MatchResult = (\r\n  | {\r\n      match: 'allow' | 'deny';\r\n      ruleID: UUID;\r\n    }\r\n  | {\r\n      match: 'none';\r\n    }\r\n) &\r\n  PageDetails;\r\n\r\nexport type PageContextTransformationType =\r\n  | 'default'\r\n  | 'replace'\r\n  | 'extend'\r\n  | 'metabase';\r\n\r\nexport type PageContextTransformation = {\r\n  type: PageContextTransformationType;\r\n  data: JsonObject | null;\r\n};\r\n\r\nexport type ProvidersResult = {\r\n  ruleProviders: RuleProvider[];\r\n  version: string;\r\n};\r\n\r\nexport type DeepPartial<T> = {\r\n  [P in keyof T]?: DeepPartial<T[P]>;\r\n};\r\n\r\nexport type LinearTeam = {\r\n  id: string;\r\n  name: string;\r\n  projects: {\r\n    nodes: Array<{\r\n      id: string;\r\n      name: string;\r\n    }>;\r\n  };\r\n};\r\n\r\nexport type AtlassianProject = {\r\n  // expand: 'description,lead,issueTypes,url,projectKeys,permissions,insight',\r\n  id: string; // 10000\r\n  key: string; // STLR\r\n  name: string; // 'Stellar'\r\n  issueTypes: Array<{\r\n    id: string; //'10001'\r\n    // description: 'Tasks track small, distinct pieces of work.';\r\n    name: string;\r\n    subtask: boolean;\r\n    // avatarId: 10318;\r\n    // hierarchyLevel: 0;\r\n  }>;\r\n  simplified: boolean;\r\n  style: string; // 'next-gen'\r\n  isPrivate: boolean;\r\n  entityId: UUID;\r\n  uuid: UUID;\r\n};\r\n\r\nexport type MondayBoard = {\r\n  id: string;\r\n  name: string;\r\n  subitem_board?: {\r\n    id: string;\r\n  };\r\n  groups: Array<{\r\n    id: string;\r\n    title: string;\r\n    position: string;\r\n  }>;\r\n};\r\n\r\nexport type JiraConnectionPreferences = {\r\n  projectID: string;\r\n  issueType: string;\r\n  subissueType?: string;\r\n};\r\n\r\nexport type AsanaConnectionPreferences = {\r\n  projectID: string | undefined;\r\n};\r\n\r\nexport type MondayConnectionPreferences = {\r\n  boardID: string;\r\n  groupID?: string;\r\n};\r\n\r\ntype TrelloList = {\r\n  id: UUID;\r\n  name: string;\r\n  closed?: string;\r\n  pos?: number;\r\n  softLimit?: string;\r\n  idBoard?: UUID;\r\n  subscriber: boolean;\r\n};\r\n\r\ntype TrelloBoard = {\r\n  id: UUID;\r\n  name: string;\r\n  idOrganization: UUID;\r\n  lists: TrelloList[];\r\n};\r\n\r\ntype TrelloOrg = {\r\n  id: UUID;\r\n  name: string;\r\n};\r\n\r\nexport type TrelloConnectionPreferencesType = {\r\n  id: UUID;\r\n  email: string;\r\n  boards: TrelloBoard[];\r\n  organizations: TrelloOrg[];\r\n};\r\n\r\nexport type TrelloCard = {\r\n  name: string;\r\n  desc: string;\r\n  idList: UUID;\r\n};\r\n\r\nexport type AsanaProject = {\r\n  gid: string;\r\n  name: string;\r\n};\r\n\r\nexport type JiraIssuePreviewData = {\r\n  key: string;\r\n  title: string;\r\n  url: string;\r\n  assignee: string | undefined;\r\n  status: string;\r\n  done: boolean;\r\n  priority: string;\r\n  subtasks: Array<{\r\n    id: string;\r\n    title: string;\r\n    done: boolean;\r\n  }>;\r\n};\r\n\r\nexport type AsanaTaskPreviewData = {\r\n  title: string;\r\n  url: string;\r\n  assignee: string | undefined;\r\n  done: boolean;\r\n};\r\n\r\nexport type LinearIssuePreviewData = {\r\n  title: string;\r\n  identifier: string;\r\n  url: string;\r\n  assignee: string | undefined;\r\n  status: string;\r\n  priority: string;\r\n  done: boolean;\r\n  orgName: string | undefined;\r\n};\r\n\r\nexport type MondayItemPreviewData = {\r\n  title: string;\r\n  url: string;\r\n  assignee: string | undefined;\r\n  done: boolean;\r\n  assigneeColumnID: string | undefined;\r\n  statusColumnID: string | undefined;\r\n};\r\n\r\nexport type TaskPreviewData =\r\n  | AsanaTaskPreviewData\r\n  | JiraIssuePreviewData\r\n  | LinearIssuePreviewData\r\n  | MondayItemPreviewData;\r\n\r\nexport enum LinearIssueStateTypes {\r\n  BACKLOG = 'backlog',\r\n  TODO = 'unstarted',\r\n  IN_PROGRESS = 'started',\r\n  DONE = 'completed',\r\n  CANCELED = 'canceled',\r\n}\r\n\r\nexport type LinearConnectionPreferences = {\r\n  teamID: string;\r\n  projectID?: string;\r\n};\r\n\r\nexport type APICordTokenData = {\r\n  session_id: UUID;\r\n};\r\n\r\nexport type AppServerAuthTokenData = {\r\n  app_id: UUID;\r\n};\r\n\r\nexport type CustomerServerAuthTokenData = {\r\n  customer_id: UUID;\r\n};\r\n\r\nexport type NotificationChannels = {\r\n  slack: boolean;\r\n  email: boolean;\r\n};\r\n\r\nexport type CustomLinks = {\r\n  learnMore?: string | null;\r\n  upgradePlan?: string | null;\r\n  leaveFeedback?: string | null;\r\n};\r\n\r\nexport type ThirdPartyAuth = 'slack' | 'google' | 'ms-teams';\r\n\r\nexport type OutboundNotificationType =\r\n  | 'slack'\r\n  | 'email'\r\n  | 'slackEmailMatched'\r\n  | 'sharedToSlackChannel'\r\n  | 'sharedToEmail';\r\n\r\nexport type { Point2D } from '@cord-sdk/types';\r\n\r\nexport type CustomNUXStepContent = {\r\n  title: string | null;\r\n  text: string | null;\r\n  imageURL: string | null;\r\n};\r\n\r\nexport type CustomNUX = {\r\n  initialOpen: CustomNUXStepContent | null;\r\n  welcome: CustomNUXStepContent | null;\r\n};\r\n\r\nexport type SlackOAuthLinkOrgState = {\r\n  data: {\r\n    userID: string;\r\n    orgID: string;\r\n    platformApplicationID: string;\r\n  };\r\n  type: 'link_org';\r\n  nonce: string;\r\n};\r\n\r\nexport type SlackOAuthConsoleUserState = {\r\n  data: {\r\n    platformApplicationID: string;\r\n  };\r\n  type: 'console_user';\r\n  nonce: string;\r\n};\r\n\r\nexport type SlackOAuthDecodeState =\r\n  | SlackOAuthLinkOrgState\r\n  | SlackOAuthConsoleUserState;\r\n\r\nexport type ThreadSupportStatusType = 'open' | 'closed';\r\n\r\nexport type UserWithOrgDetails = {\r\n  id: UUID;\r\n  externalID: string;\r\n  displayName: string;\r\n  fullName: string;\r\n  name: string | null;\r\n  shortName: string | null;\r\n  profilePictureURL: string | null;\r\n  metadata: EntityMetadata;\r\n  canBeNotifiedOnSlack: boolean;\r\n};\r\n\r\nexport type OutboundNotificationMetadata =\r\n  OutboundNotificationMetadataByType[OutboundNotificationType];\r\n\r\n// when adding new fields to existing metadata types, either make the new\r\n// fields optional or run a backfill migration\r\nexport type OutboundNotificationMetadataByType = {\r\n  slack: Record<string, never>;\r\n  email: Record<string, never>;\r\n  slackEmailMatched: Record<string, never>;\r\n  sharedToSlackChannel: {\r\n    type: 'sharedToSlackChannel';\r\n    targetSlackChannelID: string;\r\n  };\r\n  sharedToEmail: {\r\n    type: 'sharedToEmail';\r\n    targetEmail: string;\r\n  };\r\n};\r\n\r\n// Internal threads are the standard mirrored Slack threads\r\n// that users can share to their linked Slack org.\r\n// Support threads are the ones mirrored to a vendor's Slack org\r\n// and support channel after a support bot is mentioned.\r\nexport type ThreadMirrorType = 'internal' | 'support';\r\n\r\nexport type Tier = 'prod' | 'staging' | 'test' | 'dev';\r\n\r\nexport type SharedToSlackInfo = {\r\n  channel: string | null;\r\n  slackURL: string | null;\r\n};\r\n\r\nexport type ThreadMode =\r\n  // Only shows the first message, and optionally the number of replies\r\n  | 'collapsed'\r\n  // Can show all messages, also includes a composer to add a new message\r\n  | 'inline'\r\n  // Used in the sidebar only - thread spans across the whole page\r\n  | 'fullHeight'\r\n  // The initial state when we are creating a new thread - composer only\r\n  | 'newThread';\r\n\r\nexport type Announcement =\r\n  | 'welcome'\r\n  | 'completeProfile'\r\n  | 'connectOrgToSlack'\r\n  | 'linkProfileToSlack'\r\n  | 'slackIsConnected';\r\n\r\nexport type ReferencedUserData = { id: UUID; name: string };\r\n\r\nconst DEPLOYMENT_TYPES = ['sdk'] as const;\r\n\r\nexport type DeploymentType = (typeof DEPLOYMENT_TYPES)[number];\r\n\r\nexport function isDeploymentType(s: string): s is DeploymentType {\r\n  if (DEPLOYMENT_TYPES.includes(s as DeploymentType)) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function toDeploymentType(\r\n  s: string | null | undefined,\r\n): DeploymentType | null {\r\n  if (s && isDeploymentType(s)) {\r\n    return s;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport type ApplicationEnvironment =\r\n  | 'production'\r\n  | 'staging'\r\n  | 'sample' // console self-serve test (not paying) app\r\n  | 'sampletoken' // sample token apps created for docs integration guide and demo apps opensource repos (wiped periodically)\r\n  | 'demo'; // temporary token apps created for docs and cord.com demo apps (wiped periodically)\r\n\r\n// NB you there are some classes of token you might expect are environments,\r\n// but actually all belong to one appID:\r\n// The docs live components are all in the CORD_DOCS_SAMPLE_TOKEN_APPLICATION_ID app\r\n// The e2e tests are all in the CORD_AUTOMATED_TESTS_APPLICATION_ID app\r\n// The CORD_PLAYGROUND_APPLICATION_ID has been retired from service\r\n\r\nexport type EmptyJsonObject = Record<string, never>;\r\n\r\nexport type CustomerType = 'verified' | 'sample';\r\n\r\nexport type CustomerImplementationStage =\r\n  | 'launched'\r\n  | 'implementing'\r\n  | 'proof_of_concept'\r\n  | 'inactive';\r\n\r\nexport type AdminCRTComingFrom = 'them' | 'us';\r\n\r\nexport type AdminCRTDecision = 'done' | 'accepted' | 'rejected' | 'pending';\r\n\r\nexport type AdminCRTCommunicationStatus =\r\n  | 'none'\r\n  | 'request_acked'\r\n  | 'decision_sent'\r\n  | 'decision_acked';\r\n\r\nexport type AdminCRTIssueType = 'request' | 'bug' | 'onboarding_step';\r\n\r\nexport type AdminCRTPriority = 'blocker' | 'high' | 'low';\r\n\r\nexport type AdminCRTCustomerIssue = {\r\n  customerID: UUID;\r\n  title: string;\r\n  body: string;\r\n  comingFrom: AdminCRTComingFrom;\r\n  decision: AdminCRTDecision;\r\n  communicationStatus: AdminCRTCommunicationStatus;\r\n  lastTouch?: string;\r\n  type: AdminCRTIssueType;\r\n  priority: AdminCRTPriority;\r\n  externallyVisible: boolean;\r\n  assignee?: UUID;\r\n};\r\n\r\nexport type DocsCachedEmbedding = {\r\n  url: string;\r\n  plaintext: string;\r\n  embedding?: OpenAI.CreateEmbeddingResponse | undefined;\r\n};\r\n\r\nexport type CordDotComCachedEmbedding = DocsCachedEmbedding & {\r\n  title: string;\r\n};\r\n\r\n// This is for the mouse move events within iframes\r\nexport type IframeMouseMoveData = { x: number; y: number; frame_id: string };\r\n\r\nexport type Maybe<T> = T | null | undefined;\r\nexport type Nullable<T> = T | null;\r\n", "// This is for important URLs to all kinds of services\r\n\r\nexport const TOP_SERVER_HOST = process.env.TOP_SERVER_HOST!;\r\nexport const APP_SERVER_HOST = process.env.APP_SERVER_HOST!;\r\nexport const API_SERVER_HOST = process.env.API_SERVER_HOST!;\r\nexport const API_SERVER_HOST_PRODUCTION =\r\n  process.env.API_SERVER_HOST_PRODUCTION!;\r\nexport const ADMIN_SERVER_HOST = process.env.ADMIN_SERVER_HOST!;\r\nexport const CONSOLE_SERVER_HOST = process.env.CONSOLE_SERVER_HOST!;\r\nexport const MARKETING_SERVER_HOST = process.env.MARKETING_SERVER_HOST!;\r\nexport const CORD_TO_HOST = process.env.CORD_TO_HOST!;\r\nexport const AUTH0_CUSTOM_LOGIN_DOMAIN = process.env.AUTH0_CUSTOM_LOGIN_DOMAIN!;\r\nexport const DOCS_SERVER_HOST = process.env.DOCS_SERVER_HOST!;\r\nexport const SLACK_APP_REDIRECT_HOST = process.env.SLACK_APP_REDIRECT_HOST;\r\n\r\nexport const TOP_ORIGIN = 'https://' + process.env.TOP_SERVER_HOST;\r\nexport const APP_ORIGIN = 'https://' + process.env.APP_SERVER_HOST;\r\nexport const API_ORIGIN = 'https://' + process.env.API_SERVER_HOST;\r\nexport const ADMIN_ORIGIN = 'https://' + process.env.ADMIN_SERVER_HOST;\r\nexport const CONSOLE_ORIGIN = 'https://' + process.env.CONSOLE_SERVER_HOST;\r\nexport const MARKETING_ORIGIN = 'https://' + process.env.MARKETING_SERVER_HOST;\r\nexport const CORD_TO_ORIGIN = 'https://' + process.env.CORD_TO_HOST;\r\nexport const AUTH0_ORIGIN = 'https://' + process.env.AUTH0_CUSTOM_LOGIN_DOMAIN;\r\nexport const DOCS_ORIGIN = 'https://' + process.env.DOCS_SERVER_HOST;\r\nexport const DOCS_AI_CHATBOT_SERVER_HOST =\r\n  process.env.DOCS_AI_CHATBOT_SERVER_HOST;\r\nexport const COMMUNITY_ORIGIN = 'https://' + process.env.COMMUNITY_SERVER_HOST;\r\n\r\n// See https://github.com/getcord/interactive-demos\r\nexport const DEMO_APPS_WEBHOOK_URL =\r\n  'https://cord-interactive-demos.vercel.app/events';\r\n", "import { DOCS_ORIGIN } from 'common/const/Urls.ts';\r\n\r\nexport const SUPPORT_USER_UUID = 'c9a61e1d-7c8a-4c7e-838a-9d431cf4ed77';\r\nexport const RADICAL_ORG_ID = '6bba8678-b14e-4af7-b2f2-05ee807dfa82';\r\nexport const RADICAL_TEST_ORG_ID = '3689f86d-0c70-40de-a2f0-a4a9ea4994e3';\r\nexport const CORD_PLATFORM_ORG_ID = '746c0b57-7363-4766-9ee9-7ae8ec7531a8';\r\nexport const CORD_ADMIN_PLATFORM_ORG_ID =\r\n  '84ae9086-8414-4ed3-ab73-096e6438f095';\r\nexport const CORD_SDK_TEST_ORG_ID = 'edda098d-6db7-4202-a5ac-ff3293b78c47';\r\nexport const GILLIAN_TEST_SLACK_ORG_ID = 'f7ab9ab8-f5b2-41a4-a419-1b8076626d3f';\r\nexport const KAT_TEST_SLACK_ORG_ID = '4506fadd-f8dc-4795-9b5d-d28feda39d84';\r\nexport const CORD_SLACK_TEAM_ID = 'T012Y0TBQLW'; // radicalhqworkspace\r\nexport const CORD_TEST_SLACK_TEAM_ID = 'T015UJY6YQK'; // radicaltestorg\r\n\r\nexport const SLACK_APP_CLIENT_ID = '1100027398710.1180115520790';\r\nexport const SLACK_APP_ID = 'A015A3DFAP8';\r\nexport const SLACK_DEV_APP_CLIENT_ID = '1198644236835.1943446227956';\r\nexport const SLACK_ADMIN_LOGIN_APP_CLIENT_ID = '1100027398710.2437628320357';\r\nexport const SLACK_ADMIN_LOGIN_APP_ID = 'A02CVJG9EAH';\r\nexport const SLACK_DEV_APP_ID = 'A01TRD46PU4';\r\nexport const SLACK_INTERNAL_TOOLS_APP_ID = 'A04JKM945CM';\r\nexport const CORD_UPDATES_TEST_CHANNEL_ID = 'C0547K3V868';\r\n\r\n// As opposed to e.g. a customer's Slack app\r\nexport const CORD_SLACK_APP_IDS = [\r\n  SLACK_APP_ID,\r\n  SLACK_DEV_APP_ID,\r\n  SLACK_ADMIN_LOGIN_APP_ID,\r\n  SLACK_INTERNAL_TOOLS_APP_ID,\r\n];\r\n\r\nexport const CORD_APPLICATION_ID = '5a076ee9-8b9e-4156-9ac4-871bdc4569ec';\r\nexport const CORD_SDK_TEST_APPLICATION_ID =\r\n  'b6501bf5-46f7-4db7-9996-c42dd9f758b0';\r\nexport const CORD_SAMPLE_TOKEN_CUSTOMER_ID =\r\n  '1c367aca-37c9-4733-8bef-e9f11a7d0f17';\r\nexport const CORD_DEMO_APPS_TOKEN_CUSTOMER_ID =\r\n  '4383cf39-8b6a-4c33-9d8a-71567ed47a60';\r\nexport const CORD_DOCS_SAMPLE_TOKEN_APPLICATION_ID =\r\n  'aeb2797f-f0a3-485c-a317-4986e2c8343b';\r\nexport const CORD_AUTOMATED_TESTS_APPLICATION_ID =\r\n  'dfa86152-9e7e-4d2d-acd6-bfddef71f58e';\r\nexport const CLACK_APPLICATION_ID = '5fa22ba9-5446-4af8-bc93-7ce54a9aa0ba';\r\nexport const CORD_HOMEPAGE_APPLICATION_ID =\r\n  '29e6499a-bbed-4eb2-b057-b36d60ad76c9';\r\nexport const AUTH0_CLIENT_ID = process.env.AUTH0_CLIENT_ID!;\r\n\r\nexport const CORD_CUSTOMER_ID = '12ed6251-28d5-4686-9a75-20a15bd31499';\r\n\r\nexport const CSS_CUSTOMIZATION_ON_DOCS_PREFIX = 'css-customization-';\r\nexport const BETA_V2_DOCS_PREFIX = 'beta2-';\r\nexport const LIVE_CSS_ON_DOCS_THREAD_ID_PREFIX = 'live-css-docs-thread-';\r\nexport const LIVE_COMPONENT_ON_DOCS_THREAD_ID_PREFIX =\r\n  'live-component-docs-thread-';\r\nexport const LIVE_COMPONENT_INBOX_THREAD_ID_PREFIX =\r\n  'live_component-docs-inbox-thread-';\r\nexport const LIVE_COMPONENT_INBOX_LAUNCHER_THREAD_ID_PREFIX =\r\n  'live_component-docs-inbox-launcher-thread-';\r\nexport const LIVE_COMPONENT_ON_DOCS_COMPOSER_THREAD_ID_PREFIX =\r\n  'live-component-docs-composer-thread-';\r\nexport const LIVE_COMPONENT_ON_DOCS_MESSAGE_THREAD_ID_PREFIX =\r\n  'live-component-docs-message-thread-';\r\nexport const LIVE_COMPONENT_ON_DOCS_MESSAGE_CONTENT_THREAD_ID_PREFIX =\r\n  'live-component-docs-message-content-thread-';\r\nexport const LIVE_COMPONENT_ON_DOCS_PIN_THREAD_ID_PREFIX =\r\n  'live-component-docs-pin-thread-';\r\nexport const LIVE_COMPONENT_ON_DOCS_REACTIONS_THREAD_ID_PREFIX =\r\n  'live-component-docs-reactions-thread-';\r\nexport const LIVE_COMPONENT_ON_DOCS_EXTERNAL_NOTIFICATION_PREFIX =\r\n  'live-component-docs-external-notification-';\r\nexport const LIVE_CUSTOMIZATION_ON_DOCS_REPLACEMENTS_THREAD_ID_PREFIX =\r\n  'live-customization-docs-replacements-thread-';\r\nexport const DOCS_TOKEN_KEY = 'docs-token';\r\n\r\nexport const LIVE_COMPONENT_ON_DOCS_NO_AVATAR_USER_ID = 'noavatar';\r\n\r\nexport const DOCS_LIVE_PAGE_LOCATIONS = {\r\n  cssCustomization: 'css-customization',\r\n  liveCss: 'live-css-docs',\r\n  liveThread: 'live-thread',\r\n  liveThreadList: 'live-thread-list',\r\n  livePin: 'live-pin',\r\n  livePinChartExample: 'live-pin-chart-example',\r\n  liveFloatingThreads: 'live-floating-threads',\r\n  liveSelectionComments: 'live-selection-comments',\r\n  liveSidebar: 'live-sidebar',\r\n  liveInbox: 'live-inbox',\r\n  liveInboxLauncher: 'live-inbox-launcher',\r\n  liveSidebarLauncher: 'live-sidebar-launcher',\r\n  livePagePresence: 'live-page-presence',\r\n  livePresenceFacepile: 'live-presence-facepile',\r\n  liveComposer: 'live-composer',\r\n  liveMessage: 'live-message',\r\n  liveMessageContent: 'live-message-content',\r\n  liveNotificationList: 'live-notification-list',\r\n  liveThreadedComments: 'live-threaded-comments',\r\n  liveReactions: 'live-reactions',\r\n  liveReplacementsTutorial: 'live-replacements-tutorial',\r\n  liveBetaV2Thread: 'live-beta-v2-thread',\r\n  liveBetaV2Threads: 'live-beta-v2-threads',\r\n};\r\n\r\nexport const CORD_DOCS_CLIENT_TOKEN = '__cord_docs_token__';\r\n\r\nexport const DOCS_URLS = {\r\n  tutorials: {\r\n    getProductionReady: {\r\n      addYourBranding: `${DOCS_ORIGIN}/get-started/live-css-editor`,\r\n    },\r\n    integrationGuide: `${DOCS_ORIGIN}/get-started/integration-guide`,\r\n    demoApps: `${DOCS_ORIGIN}/get-started/demo-apps`,\r\n  },\r\n  components: {\r\n    thread: `${DOCS_ORIGIN}/components/cord-thread`,\r\n    threadList: `${DOCS_ORIGIN}/components/cord-thread-list`,\r\n    threadedComments: `${DOCS_ORIGIN}/components/cord-threaded-comments`,\r\n    sidebar: `${DOCS_ORIGIN}/components/cord-sidebar`,\r\n    inbox: `${DOCS_ORIGIN}/components/cord-inbox`,\r\n    inboxLauncher: `${DOCS_ORIGIN}/components/cord-inbox-launcher`,\r\n    sidebarLauncher: `${DOCS_ORIGIN}/components/cord-sidebar-launcher`,\r\n    composer: `${DOCS_ORIGIN}/components/cord-composer`,\r\n    message: `${DOCS_ORIGIN}/components/cord-message`,\r\n    messageContent: `${DOCS_ORIGIN}/components/cord-message-content`,\r\n    reactions: `${DOCS_ORIGIN}/components/cord-reactions`,\r\n  },\r\n  howTo: {\r\n    customThreadedComments: `${DOCS_ORIGIN}/customization/custom-threaded-comments`,\r\n    cssCustomization: `${DOCS_ORIGIN}/customization/css`,\r\n    replacements: `${DOCS_ORIGIN}/customization/custom-react-components/tutorial`,\r\n  },\r\n  getStarted: {\r\n    authenticateYourUser: `${DOCS_ORIGIN}/get-started/integration-guide/generate-an-auth-token`,\r\n  },\r\n  betaV2Components: {\r\n    threads: `${DOCS_ORIGIN}/components/cord-threads?version=2.0`,\r\n    thread: `${DOCS_ORIGIN}/components/cord-thread?version=2.0`,\r\n  },\r\n};\r\n\r\nexport const CORD_DEV_CONSOLE_LOGGING_SLACK_CHANNEL_ID = 'C05FAVBSSN7';\r\nexport const CORD_SELF_SERVE_SLACK_CHANNEL_ID = 'C05GR4WSV5Z';\r\n\r\n// Tokens created for the sample token and demo apps environment types both\r\n// create groups with this id.  Both of them need to use the same groupID because\r\n// it is hardcoded into the demo apps client code, and while the demo apps mostly\r\n// use the demo apps environment apps, they sometimes use sample app tokens.\r\nexport const DEMO_APPS_APP_GROUP_ID = 'my-first-group';\r\n", "import type { Node } from 'slate';\r\nimport { Element } from 'slate';\r\nimport { v4 as uuid } from 'uuid';\r\nimport { MessageNodeType } from '@cord-sdk/types';\r\nimport type {\r\n  MessageAssigneeNode,\r\n  MessageContent,\r\n  MessageMentionNode,\r\n  MessageNode,\r\n  MessageNodeWithChildren,\r\n  MessageStyledBlockType,\r\n  MessageTextNode,\r\n  MessageTodoNode,\r\n  UUID,\r\n} from '@cord-sdk/types';\r\nimport { trimStart, trimEnd } from './trim.js';\r\n\r\nexport const MAX_BULLET_INDENT = 4;\r\n\r\n// '& Node' in return value stops Slate complaining when passing node to its methods\r\n// Casting to any is because TS doesn't seem to like combining the two to make the node\r\nexport function createMessageNode<\r\n  NodeType extends MessageNodeType,\r\n  NodeAttributes extends MessageNode<NodeType> = MessageNode<NodeType>,\r\n>(\r\n  nodeType: NodeType,\r\n  nodeAttributes: Omit<NodeAttributes, 'type'>,\r\n): MessageNode<NodeType> & Node {\r\n  return {\r\n    type: nodeType,\r\n    ...nodeAttributes,\r\n  } as any;\r\n}\r\n\r\nexport function createMessageTextNode(text: string): MessageTextNode {\r\n  return {\r\n    text,\r\n  };\r\n}\r\n\r\nexport function createFormattedMessageTextNode(input: {\r\n  text: string;\r\n  bold?: boolean;\r\n  italic?: boolean;\r\n  underline?: boolean;\r\n  code?: boolean;\r\n}): MessageTextNode {\r\n  return input;\r\n}\r\n\r\nexport function isMessageNodeType<NodeType extends MessageNodeType>(\r\n  node: Node | undefined,\r\n  nodeType: NodeType,\r\n): node is MessageNode<NodeType> {\r\n  return Boolean(node && Element.isElement(node) && node.type === nodeType);\r\n}\r\n\r\nexport function isMessageNodeText(node: MessageNode): node is MessageTextNode {\r\n  return !node.type && 'text' in node;\r\n}\r\n\r\nexport function createParagraphNode(text = '') {\r\n  return createMessageNode(MessageNodeType.PARAGRAPH, {\r\n    children: [{ text }],\r\n  });\r\n}\r\n\r\nexport function createMentionNode(userID: UUID, name: string) {\r\n  return createMessageNode(MessageNodeType.MENTION, {\r\n    user: { id: userID },\r\n    children: [{ text: `@${name}` }],\r\n  });\r\n}\r\n\r\nexport function createAssigneeNode(userID: UUID, name: string) {\r\n  return createMessageNode(MessageNodeType.ASSIGNEE, {\r\n    user: { id: userID },\r\n    children: [{ text: `+${name}` }],\r\n  });\r\n}\r\n\r\nexport function createLinkNode(url: string, text: string) {\r\n  return createMessageNode(MessageNodeType.LINK, {\r\n    url,\r\n    children: [{ text }],\r\n  });\r\n}\r\n\r\nexport function messageContentFromString(text: string): MessageContent {\r\n  return [createParagraphNode(text)];\r\n}\r\n\r\nfunction getInitialStyledBlockProps(\r\n  blockType: MessageStyledBlockType,\r\n  indent?: number,\r\n) {\r\n  if (blockType === MessageNodeType.TODO) {\r\n    return {\r\n      done: false,\r\n      todoID: uuid(),\r\n    };\r\n  } else if (\r\n    blockType === MessageNodeType.BULLET ||\r\n    blockType === MessageNodeType.NUMBER_BULLET\r\n  ) {\r\n    return {\r\n      indent,\r\n    };\r\n  } else {\r\n    return {};\r\n  }\r\n}\r\n\r\nexport function createStyledBlockNode(\r\n  blockType: MessageStyledBlockType,\r\n  text: string,\r\n  indent?: number,\r\n) {\r\n  return createMessageNode(blockType, {\r\n    children: messageContentFromString(text),\r\n    ...getInitialStyledBlockProps(blockType, indent),\r\n  });\r\n}\r\n\r\nconst findTodoNodesInSubtree = (\r\n  parent: MessageNode,\r\n  accumulator: MessageTodoNode[],\r\n): void => {\r\n  if (parent.type === MessageNodeType.TODO) {\r\n    accumulator.push(parent);\r\n  } else {\r\n    const children = getMessageNodeChildren(parent);\r\n    if (children) {\r\n      for (const node of children) {\r\n        findTodoNodesInSubtree(node, accumulator);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const todoNodesFromMessage = (messageContent: MessageContent) => {\r\n  const accumulator: MessageTodoNode[] = [];\r\n\r\n  for (const node of messageContent) {\r\n    findTodoNodesInSubtree(node, accumulator);\r\n  }\r\n\r\n  return accumulator;\r\n};\r\n\r\nexport function getMessageNodeChildren(node: MessageNode) {\r\n  return (node as MessageNodeWithChildren).children;\r\n}\r\n\r\nexport const textFromNodeRecursive = (node: MessageNode): string => {\r\n  let textArr: Array<string> = [];\r\n\r\n  if (isMessageNodeText(node)) {\r\n    return node.text;\r\n  }\r\n\r\n  const children = getMessageNodeChildren(node);\r\n  if (children) {\r\n    textArr = textArr.concat(\r\n      children.map((child) => textFromNodeRecursive(child)),\r\n    );\r\n  }\r\n\r\n  const result = textArr.join('');\r\n\r\n  return result;\r\n};\r\n\r\nexport function convertStructuredMessageToText(\r\n  messageContent: MessageContent,\r\n): string {\r\n  return messageContent\r\n    .map((node) => textFromNodeRecursive(node))\r\n    .join('\\n')\r\n    .trim();\r\n}\r\n\r\n// converts a list of MessageNode into text.\r\n// any whitespace or assignees at the start/end are removed.\r\nfunction taskTitleFromMessageNodes(\r\n  nodes: (MessageTextNode | MessageAssigneeNode | MessageMentionNode)[],\r\n): string {\r\n  let pending = '';\r\n  let text = '';\r\n\r\n  for (const node of nodes) {\r\n    if (node.type === MessageNodeType.ASSIGNEE) {\r\n      if (text.trim() === '') {\r\n        // no text was seen so far, so this is an assignee at the start of a\r\n        // message. We want to skip those.\r\n        continue;\r\n      }\r\n      // okay, we have seen some text already, but this assignee might be at\r\n      // the very end of the message. Hence let the assignee wait in the\r\n      // pending until we find non-empty text (which would mean the assignee is\r\n      // not at the end of the message)\r\n      pending += trimStart(textFromNodeRecursive(node), '+');\r\n      continue;\r\n    }\r\n\r\n    let newText = '';\r\n    if (isMessageNodeText(node)) {\r\n      newText = node.text;\r\n    } else if (node.type === MessageNodeType.MENTION) {\r\n      newText = trimStart(textFromNodeRecursive(node), '@');\r\n    }\r\n\r\n    const isEmpty = newText.trim() === '';\r\n    if (isEmpty) {\r\n      // this might be either trailing whitespace or whitespace in the middle\r\n      // of the message. For now, let's have it in pending until something\r\n      // non-empty arrives\r\n      pending += newText;\r\n    } else {\r\n      // we found some non-empty text so whatever was waiting in the pending\r\n      // can now finally become part of text\r\n      text += pending + newText;\r\n      pending = '';\r\n    }\r\n  }\r\n\r\n  return trimEnd(text.trim(), ':').trim();\r\n}\r\n\r\n// converts each MessageNode into text, returns the first non-empty one.\r\nexport function taskTitleFromMessageContent(\r\n  messageContent: MessageContent,\r\n): string {\r\n  for (let i = 0; i < messageContent.length; i++) {\r\n    const nodes: (\r\n      | MessageTextNode\r\n      | MessageAssigneeNode\r\n      | MessageMentionNode\r\n    )[] = [];\r\n    flattenMessage(messageContent[i], nodes);\r\n\r\n    const title = taskTitleFromMessageNodes(nodes);\r\n    if (title.length > 0) {\r\n      return title;\r\n    }\r\n  }\r\n\r\n  return 'Task created using Cord';\r\n}\r\n\r\nfunction flattenMessage(\r\n  node: MessageNode,\r\n  accumulator: (MessageTextNode | MessageAssigneeNode | MessageMentionNode)[],\r\n) {\r\n  if (\r\n    isMessageNodeText(node) ||\r\n    node.type === MessageNodeType.ASSIGNEE ||\r\n    node.type === MessageNodeType.MENTION\r\n  ) {\r\n    accumulator.push(node);\r\n    return;\r\n  }\r\n  const children = getMessageNodeChildren(node);\r\n  if (!children) {\r\n    return;\r\n  }\r\n\r\n  for (const child of children) {\r\n    flattenMessage(child, accumulator);\r\n  }\r\n}\r\n\r\n// message.content is null if message is deleted\r\nexport const findMessageNode = (\r\n  arr: MessageContent | null,\r\n  nodeType: MessageNodeType,\r\n): any => {\r\n  if (!arr) {\r\n    return null;\r\n  }\r\n  for (const item of arr) {\r\n    if (item.type === nodeType) {\r\n      return item;\r\n    }\r\n    if ('children' in item) {\r\n      const p = findMessageNode(item.children, nodeType);\r\n      if (p) {\r\n        return p;\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n"],
  "mappings": "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",
  "names": ["jsonStableStringify"]
}
